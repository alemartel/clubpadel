# User Profile Update Feature - Technical Plan

## Feature Description

Create a user profile update page that allows users to edit their personal information including name, surname, and phone number. The email field is read-only as it's used for authentication. The profile page should be accessible via a small avatar in the navbar and feature a minimalist, modern design with light tones, responsive design, and mobile-first approach.

## Database Schema Changes

### Phase 1: Data Layer

**File: `server/src/schema/users.ts`**

- Add new fields to the users table:
  - `first_name: text('first_name')`
  - `last_name: text('last_name')`
  - `phone_number: text('phone_number')`
- Update the User type to include these new fields
- Create database migration to add these columns

## Backend API Changes

### Phase 2A: API Layer

**File: `server/src/api.ts`**

- Add new protected route `PUT /protected/profile` to update user profile
- Implement profile update logic that:
  - Validates input data (name, surname, phone number)
  - Updates only the provided fields
  - Updates the `updated_at` timestamp
  - Returns the updated user object

**File: `ui/src/lib/serverComm.ts`**

- Add `updateUserProfile(data: ProfileUpdateData)` function
- Add TypeScript interface for ProfileUpdateData
- Implement API call to the new profile update endpoint

## Frontend Changes

### Phase 2B: UI Components

**File: `ui/src/components/navbar.tsx`**

- Replace the current welcome text with a small avatar component
- Add click handler to navigate to profile page
- Use user's photo_url or display initials as fallback

**File: `ui/src/components/ui/avatar.tsx`**

- Enhance existing avatar component to support:
  - Clickable functionality
  - Fallback to user initials when no photo
  - Proper sizing for navbar use

**File: `ui/src/pages/Profile.tsx` (new file)**

- Create new profile page component with:
  - Form fields for first_name, last_name, phone_number
  - Read-only email field
  - Save/Cancel buttons
  - Form validation
  - Loading states
  - Error handling
  - Mobile-first responsive design with light tones

**File: `ui/src/components/profile-form.tsx` (new file)**

- Extract profile form logic into reusable component
- Implement form validation
- Handle form submission and API calls
- Display success/error messages

**File: `ui/src/App.tsx`**

- Add new route `/profile` for the profile page

**File: `ui/src/components/appSidebar.tsx`**

- Add profile link to sidebar navigation (optional, since navbar avatar is primary access)

## Design Requirements

### Visual Design

- Minimalist, modern design with light tones
- Mobile-first responsive approach
- Clean form layout with proper spacing
- Consistent with existing ShadCN UI components
- Light color scheme throughout

### User Experience

- Avatar in navbar provides quick access to profile
- Form validation with clear error messages
- Loading states during save operations
- Success feedback after profile updates
- Intuitive navigation back to main app

## Implementation Algorithm

1. **Database Migration**: Add new columns to users table
2. **Backend API**: Create profile update endpoint with validation
3. **Frontend API Client**: Add profile update function to serverComm
4. **Navbar Avatar**: Replace welcome text with clickable avatar
5. **Profile Page**: Create responsive profile form with validation
6. **Routing**: Add profile route to app routing
7. **Testing**: Verify mobile responsiveness and form functionality

## Files to Create/Modify

### New Files

- `ui/src/pages/Profile.tsx`
- `ui/src/components/profile-form.tsx`
- Database migration file for new user fields

### Modified Files

- `server/src/schema/users.ts` - Add new user fields
- `server/src/api.ts` - Add profile update endpoint
- `ui/src/lib/serverComm.ts` - Add profile update API function
- `ui/src/components/navbar.tsx` - Add avatar navigation
- `ui/src/components/ui/avatar.tsx` - Enhance avatar component
- `ui/src/App.tsx` - Add profile route
- `ui/src/components/appSidebar.tsx` - Optional profile link
