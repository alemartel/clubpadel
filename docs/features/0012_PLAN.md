# Remove Player Level System - Technical Plan

## Feature Description

Remove the player level system entirely. Players will no longer have individual levels - levels will be associated with teams instead (to be implemented later). This involves:

1. **Remove player level fields** from the database schema and user model
2. **Remove level validation system** - all admin approval/rejection functionality for player levels
3. **Remove level-related UI** from player profile and admin pages
4. **Remove level checks** from team creation and team member addition
5. **Remove level-related API endpoints** for players and admins

Note: The `level` enum and related functionality for teams/groups should remain intact as it will be used when team-level functionality is implemented.

## Database Schema Changes

### Phase 1: Data Layer

**File: `server/src/schema/users.ts`**

- Remove level-related fields from users table:
  - `claimed_level: levelEnum("claimed_level")`
  - `level_validation_status: levelValidationStatusEnum("level_validation_status")`
  - `level_validated_at: timestamp("level_validated_at")`
  - `level_validated_by: text("level_validated_by")`
  - `level_validation_notes: text("level_validation_notes")`
- Remove `levelValidationStatusEnum` from imports (keep `levelEnum` and `userRoleEnum` as they're still used)
- Remove `levelValidationStatusEnum` from re-exports
- Remove `LevelValidationStatus` type export (if it exists)
- Create database migration file to drop these columns from the users table

**Note**: Keep `levelEnum` in schema/enums.ts as it's still used by groups/teams.

## Backend API Changes

### Phase 2A: Remove Player Level Endpoints

**File: `server/src/api.ts`**

- Remove `PUT /protected/profile/level` endpoint (around line 247-297)
- Remove `GET /protected/profile/level-status` endpoint (if it exists)
- Remove level-related fields from `GET /protected/me` response (around line 386-389):
  - Remove `claimed_level`, `level_validation_status`, `level_validated_at`, `level_validated_by`, `level_validation_notes` from user data selection

### Phase 2B: Remove Admin Level Validation Endpoints

**File: `server/src/api.ts`**

- Remove `GET /admin/level-validations` endpoint (around line 768-786)
- Remove `POST /admin/level-validations/:userId/approve` endpoint (around line 788-835)
- Remove `POST /admin/level-validations/:userId/reject` endpoint (around line 837-882)

### Phase 2C: Remove Level Checks from Team Operations

**File: `server/src/api.ts`**

- Remove level validation check from team creation endpoint (around line 1067-1093):
  - Remove check for `level_validation_status !== "approved"`
  - Remove check for `claimed_level !== group.level`
  - Remove level mismatch error messages
- Remove level validation check from add team member endpoint (around line 1372-1378):
  - Remove check for `level_validation_status !== "approved"`
  - Remove check for `claimed_level !== group.level`
- Remove level filter from available players endpoint (around line 1623-1624):
  - Remove filter condition `eq(users.level_validation_status, "approved")`
  - Remove filter condition `eq(users.claimed_level, level)`

## Frontend Changes

### Phase 2D: Remove Level from Profile Page

**File: `ui/src/pages/Profile.tsx`**

- Remove `LevelSelector` import (line 23)
- Remove `getPlayerLevelStatus` and `updatePlayerLevel` from serverComm imports (line 3)
- Remove `levelStatus` state (around lines 57-62)
- Remove level status fetching from `fetchUserData` function (around lines 68-72, 88-96)
- Remove `handleLevelChange` function (around lines 143-164)
- Remove `LevelSelector` component from JSX (around lines 509-519)

### Phase 2E: Remove Level from Player Management

**File: `ui/src/pages/PlayerManagement.tsx`**

- Remove `approveLevelValidation` and `rejectLevelValidation` imports (around line 5-6)
- Remove level-related fields from player interface (around line 48-50):
  - `claimed_level`, `level_validation_status`, `level_validation_notes`
- Remove level-related state (status filters, pending counts, etc.)
- Remove level badge display
- Remove approve/reject buttons and modals for level validation
- Remove level-related filter options
- Remove level-related translation keys usage

### Phase 2F: Remove Level Checks from Team Creation

**File: `ui/src/pages/CreateTeam.tsx`**

- Remove level validation check and display (around lines 146-150):
  - Remove "Your validated level" display
- Remove level mismatch warning (around lines 222-233):
  - Remove check for `serverUser?.claimed_level !== selectedGroup.level`
  - Remove level mismatch error message display
- Remove level check from submit button disabled condition (around line 238)

### Phase 2G: Remove Level from Auth Context

**File: `ui/src/lib/auth-context.tsx`**

- Remove level-related fields from `ServerUser` type (around lines 15-19):
  - `claimed_level`, `level_validation_status`, `level_validated_at`, `level_validated_by`, `level_validation_notes`
- Remove `hasValidatedLevel` from context type and calculation (around lines 30, 108)
- Remove `canCreateTeams` calculation dependency on `hasValidatedLevel` (around line 109):
  - Change to allow all players (non-admins) to create teams: `canCreateTeams = !isAdmin`

### Phase 2H: Remove Level API Functions

**File: `ui/src/lib/serverComm.ts`**

- Remove `LevelValidationStatus` type (around line 77)
- Remove `LevelValidationRequest` interface (around lines 79-88)
- Remove `LevelStatus` interface (around lines 90-96)
- Remove `updatePlayerLevel` function (around lines 130-139)
- Remove `getPlayerLevelStatus` function (around lines 141-145)
- Remove `getLevelValidationRequests` function (around lines 148-151)
- Remove `approveLevelValidation` function (around lines 153-162)
- Remove `rejectLevelValidation` function (around lines 164-173)

### Phase 2I: Remove Level Components

**Files to delete:**
- `ui/src/components/LevelSelector.tsx` - Remove level selector component
- `ui/src/components/LevelStatusBadge.tsx` - Remove level status badge component (if it exists)

**Or if components are used elsewhere:**
- Check if these components are referenced in other files and remove those references

### Phase 2J: Update Other Components

**File: `ui/src/components/FreePlayerMarket.tsx`** (if exists)

- Remove level badge display for players (around lines 147-150)

**File: `ui/src/components/FreePlayerMarketModal.tsx`** (if exists)

- Remove level badge display for players (around lines 164-167)

## Implementation Algorithm

1. **Database Migration**: Create migration to drop level-related columns from users table
2. **Schema Update**: Remove level fields from users schema (keep levelEnum for teams/groups)
3. **Backend API**: Remove all level-related endpoints (player and admin)
4. **Backend API**: Remove level checks from team creation and member addition
5. **Frontend API Client**: Remove all level-related API functions and types
6. **Auth Context**: Remove level from user type and calculations
7. **Profile Page**: Remove level selector and status display
8. **Player Management**: Remove level validation UI and functionality
9. **Team Creation**: Remove level validation checks and warnings
10. **Components**: Remove or update components that display level information
11. **Cleanup**: Remove unused level-related components

## Files to Create/Modify

### New Files

- Database migration file for removing level columns from users table

### Modified Files

#### Backend
- `server/src/schema/users.ts` - Remove level-related fields
- `server/src/api.ts` - Remove level endpoints and checks

#### Frontend
- `ui/src/lib/serverComm.ts` - Remove level-related functions and types
- `ui/src/lib/auth-context.tsx` - Remove level from user type and calculations
- `ui/src/pages/Profile.tsx` - Remove level selector
- `ui/src/pages/PlayerManagement.tsx` - Remove level validation UI
- `ui/src/pages/CreateTeam.tsx` - Remove level checks and warnings
- `ui/src/components/FreePlayerMarket.tsx` - Remove level badges (if exists)
- `ui/src/components/FreePlayerMarketModal.tsx` - Remove level badges (if exists)

### Files to Delete

- `ui/src/components/LevelSelector.tsx`
- `ui/src/components/LevelStatusBadge.tsx` (if it exists as a separate file)

## Important Notes

- **Keep `levelEnum`**: The level enum is still needed for teams/groups, so do NOT remove it from `server/src/schema/enums.ts`
- **Team level later**: The plan mentions teams will have levels later, but that's out of scope for this change
- **No breaking changes for groups**: Group level filtering and display should remain intact
- **Migration safety**: The migration should be careful to only drop columns related to player level, not team/group level functionality

