# Player User Creation Updates - Technical Plan

## Feature Description

Two changes need to be made to the player user creation and player data system:

1. **Remove Google social login** - Remove all Google sign-in functionality as it's no longer needed. Users will only use email/password authentication.

2. **Add DNI and t-shirt size fields** - Add two new optional fields to the player user schema: `dni` (text field for document identification number) and `tshirt_size` (text field for t-shirt size). These fields should be available in the profile page for users to update.

## Database Schema Changes

### Phase 1: Data Layer

**File: `server/src/schema/users.ts`**

- Add two new nullable text fields to the users table:
  - `dni: text('dni')` - Document identification number
  - `tshirt_size: text('tshirt_size')` - T-shirt size
- The User and NewUser types will automatically infer these new fields
- Create database migration file to add these columns to the users table

## Backend API Changes

### Phase 2A: API Layer - Profile Update Endpoint

**File: `server/src/api.ts`**

- Update the existing `PUT /protected/profile` endpoint (around line 206):
  - Add `dni` and `tshirt_size` to the destructured body validation
  - Add conditional updates for `dni` and `tshirt_size` in the updateData object (similar to first_name, last_name, phone_number handling)

**File: `ui/src/lib/serverComm.ts`**

- Update the `ProfileUpdateData` interface (around line 67):
  - Add optional fields: `dni?: string` and `tshirt_size?: string`

## Frontend Changes

### Phase 2B: Remove Google Login UI

**File: `ui/src/components/login-form.tsx`**

- Remove the `googleProvider` import from `@/lib/firebase`
- Remove the `signInWithPopup` import from `firebase/auth` (keep `signInWithEmailAndPassword` and `createUserWithEmailAndPassword`)
- Remove the `GoogleIcon` component (lines 9-16)
- Remove the `handleGoogleSignIn` function (lines 46-53)
- Remove the Google sign-in button from the JSX (lines 89-105):
  - Remove the "or continue with" divider section (lines 89-96)
  - Remove the Google sign-in button (lines 97-105)

**File: `ui/src/lib/firebase.ts`**

- Remove the `GoogleAuthProvider` import from `firebase/auth`
- Remove the `googleProvider` export (line 12)

**File: `ui/src/locales/en/auth.json`**

- Remove translation keys:
  - `googleSignInError` (line 26)
  - `orContinueWith` (line 27)
  - `signInWithGoogle` (line 28)

**File: `ui/src/locales/es/auth.json`**

- Remove translation keys:
  - `googleSignInError` (line 26)
  - `orContinueWith` (line 27)
  - `signInWithGoogle` (line 28)

### Phase 2C: Add DNI and T-shirt Size Fields to Profile

**File: `ui/src/pages/Profile.tsx`**

- Update the `formData` state (around line 45):
  - Add `dni: ""` and `tshirt_size: ""` fields
- Update the `fetchUserData` function's state setting (around line 75):
  - Include `dni` and `tshirt_size` from the user response: `dni: userResponse.user.dni || ""` and `tshirt_size: userResponse.user.tshirt_size || ""`
- Update the `handleSubmit` function (around line 121):
  - Add `dni` and `tshirt_size` to the `updateData` object
- Add form fields in the JSX (around line 422, after the phone_number field):
  - Add DNI input field (text input, similar to phone_number field)
  - Add T-shirt size input field (text input, similar to phone_number field)
  - Follow the same styling pattern as existing fields (grid layout, labels, inputs)

**Translation files** (if needed):

- Add translation keys for DNI and t-shirt size labels in:
  - `ui/src/locales/en/profile.json` (or relevant locale file)
  - `ui/src/locales/es/profile.json` (or relevant locale file)

## Implementation Algorithm

1. **Database Migration**: Create migration file to add `dni` and `tshirt_size` columns to users table
2. **Schema Update**: Add fields to `server/src/schema/users.ts`
3. **Backend API**: Update profile update endpoint to accept and update DNI and t-shirt size fields
4. **Frontend API Client**: Update `ProfileUpdateData` interface to include new fields
5. **Remove Google Login**: Remove all Google authentication code from login form, firebase config, and translation files
6. **Profile UI**: Add DNI and t-shirt size input fields to profile page form
7. **Testing**: Verify profile updates work correctly with new fields and Google login is fully removed

## Files to Create/Modify

### New Files

- Database migration file for adding DNI and t-shirt size fields (will be auto-generated by drizzle)

### Modified Files

#### Backend
- `server/src/schema/users.ts` - Add `dni` and `tshirt_size` fields
- `server/src/api.ts` - Update profile endpoint to handle new fields

#### Frontend
- `ui/src/lib/serverComm.ts` - Update `ProfileUpdateData` interface
- `ui/src/components/login-form.tsx` - Remove Google login functionality
- `ui/src/lib/firebase.ts` - Remove Google auth provider
- `ui/src/pages/Profile.tsx` - Add DNI and t-shirt size form fields
- `ui/src/locales/en/auth.json` - Remove Google-related translations
- `ui/src/locales/es/auth.json` - Remove Google-related translations
- Translation files for profile page (if DNI/t-shirt size labels need translations)

