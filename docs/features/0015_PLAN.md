# Admin Teams Panel with Payment and Concerns Tracking

## Context
Admins need a dedicated page to view all teams and their players, filter teams by gender and level, manage payment status for each player, and view team/player concern warnings matching existing logic from the Team Detail page.

## Required Changes

### 1. Database Schema
- **File:** `server/src/schema/team_members.ts` (or wherever team-member relationships are defined)
  - Add fields to the `team_members` table:
    - `paid` (boolean, default `false`)
    - `paid_at` (timestamp, nullable) — the date the player was marked as paid
    - `paid_amount` (numeric/decimal, nullable) — the amount the player paid

### 2. Backend/API
- **File:** `server/src/api.ts`
  - **List all teams (admin route):**
    - Create or update an endpoint `/admin/teams?gender=X&level=Y`
      - Returns all teams, with members (including `paid`, `paid_at`, `paid_amount`).
      - Accepts gender (male/female/mixed) and level (1/2/3/4) as optional filters.
      - Each player within each team includes payment info and any concerns/warnings (reusing logic from the player/team/availability warnings currently present on the team detail page).
  - **Update payment status:**
    - Add or update endpoint: `POST /admin/teams/:teamId/members/:userId/paid`
      - Accepts `{ paid: true|false, paid_at?: string, paid_amount?: number }`.
      - When marking as paid, record today's date (`paid_at`) and the entered amount (`paid_amount`).
      - When marking as not paid, reset/clear `paid`, `paid_at`, and `paid_amount` to unpaid state.
    - These routes must be protected for admin use only.

### 3. Admin UI
- **Files:**
  - New file: `ui/src/pages/AdminTeams.tsx` (or similar)
  - Update admin navigation to include link to this page for admin users only.
- **Panel features:**
  - List or table of all teams (with optional accordion/expandable UI for members).
  - Filters at the top for Gender (`Masculine`, `Feminine`, `Mixed`) and Level (1–4).
  - Each row shows:
    - Team name and details
    - Players displayed with gender icon, name, email, and payment status controls
    - Payment controls: "Mark as paid" opens a mini-form or modal for amount input, autofills today's date (`paid_at`)
      - "Mark as unpaid" resets to unpaid, clears date/amount
      - Paid state displays amount and paid_at date underneath or beside toggle
    - Any member or team warnings (concerns) shown under respective team using the same logic as team detail (e.g., not enough players, team availability requirements, etc.)
- All player `paid` states default to unpaid when new or unset.

### 4. Internationalization
- **Files:**
  - `ui/src/locales/en/teams.json` / `es/teams.json`
- Add translation keys for Paid/Unpaid, Date paid, Amount paid, Mark as Paid, Mark as Unpaid, Filter by Gender, Filter by Level, and admin-table copy as needed.

### 5. Algorithm Requirements
- When admin checks "Paid":
  1. UI prompts for an amount (required)
  2. Sets `paid = true`, `paid_at = today's date`, `paid_amount = entered value` via API
  3. UI displays paid state with date and amount
  4. Unchecking ("Unpaid") clears all three fields via the API and resets UI
- When admin visits panel:
  1. Teams page loads all teams and members; applies filters if any
  2. For each team and member, display concerns/warnings per the detail page logic

### 6. Other Files to Update
- Types/interfaces for teams/team members in both backend and frontend code
- Admin auth check/guards in route and page

---

This plan implements all specified user requirements, making the admin panel the central place for managing player payments and monitoring all team issues in one place.
