# User Roles Implementation Plan

## Overview

Implement a user role system where users can have either "admin" or "player" roles. The user with email `lauradeltoro.arq@gmail.com` will be assigned the admin role, while all other users will default to the player role.

## Technical Requirements

### Database Schema Changes

- Add a `role` field to the `users` table with enum type containing "admin" and "player" values
- Set default value to "player" for new user registrations
- Migrate existing users to have "player" role by default
- Assign "admin" role to the specific email `lauradeltoro.arq@gmail.com`

### Files to Modify

#### Schema Definition

- **File**: `server/src/schema/users.ts`
- **Changes**:
  - Import `pgEnum` from drizzle-orm/pg-core
  - Create `userRoleEnum` with "admin" and "player" values
  - Add `role` field to users table with enum type and default "player"

#### Database Migration

- **File**: `server/drizzle/0001_add_user_roles.sql` (new migration file)
- **Changes**:
  - Create enum type `user_role` with values 'admin', 'player'
  - Add `role` column to `app.users` table with default 'player'
  - Update existing users to have 'player' role
  - Set specific user with email `lauradeltoro.arq@gmail.com` to 'admin' role

#### Authentication Middleware

- **File**: `server/src/middleware/auth.ts`
- **Changes**:
  - Update user upsert to include role field with default "player"
  - Ensure new users get "player" role by default

#### TypeScript Types

- **File**: `server/src/schema/users.ts`
- **Changes**:
  - Update `User` and `NewUser` types to include role field
  - Export `UserRole` type for use in other parts of the application

### Migration Strategy

1. **Phase 1 - Schema Update**: Add role field to users table with enum type
2. **Phase 2 - Data Migration**: Update existing users and assign admin role to specified email
3. **Phase 3 - Code Update**: Update authentication middleware and types

### Database Migration Details

The migration will:

1. Create enum type `user_role` with values 'admin' and 'player'
2. Add `role` column to `app.users` table with type `user_role` and default 'player'
3. Update all existing users to have 'player' role
4. Find user with email `lauradeltoro.arq@gmail.com` and set their role to 'admin'

### Default Behavior

- New user registrations will automatically receive "player" role
- Existing users will be migrated to "player" role
- The specified admin email will be explicitly set to "admin" role
- No UI changes required for this implementation - roles are backend-only for now
