# Admin League Management Page Plan

## Overview

Create a dedicated admin-only page for managing leagues and groups within those leagues. This page will allow admins to create, edit, and delete leagues, as well as create, edit, and delete groups within each league. The page will be restricted to users with admin role and will provide a comprehensive interface for league and group management.

## Technical Requirements

### Admin Role Detection

**File**: `ui/src/lib/auth-context.tsx` (modify existing)

- Extend the AuthContextType to include server user data with role information
- Add `serverUser` field containing the full user object from the server API
- Add `isAdmin` computed field based on server user role
- Modify AuthProvider to fetch server user data after Firebase authentication

### API Integration

**File**: `ui/src/lib/serverComm.ts` (modify existing)

- Add league management API functions:
  - `getLeagues()` - Fetch all leagues
  - `getLeague(id)` - Fetch specific league with groups
  - `createLeague(data)` - Create new league
  - `updateLeague(id, data)` - Update existing league
  - `deleteLeague(id)` - Delete league
- Add group management API functions:
  - `getGroups(leagueId)` - Fetch groups for a league
  - `createGroup(leagueId, data)` - Create new group in league
  - `updateGroup(id, data)` - Update existing group
  - `deleteGroup(id)` - Delete group
- All functions use the existing `fetchWithAuth` pattern with proper error handling

### Admin Route Protection

**File**: `ui/src/App.tsx` (modify existing)

- Add new route `/admin/leagues` for the admin page
- Create `AdminRoute` component that checks `isAdmin` from auth context
- Redirect non-admin users to home page with error message
- Show loading state while checking admin status

### Admin League Management Page

**File**: `ui/src/pages/AdminLeagues.tsx` (new file)

- Create comprehensive admin interface with two main sections:
  - League management section (top)
  - Group management section (bottom, filtered by selected league)
- League management features:
  - List all leagues in a table/card layout
  - Create new league form with fields: name, start_date, end_date
  - Edit existing league inline or in modal
  - Delete league with confirmation dialog
  - Date validation (start_date < end_date)
- Group management features:
  - Show groups for selected league
  - Create new group form with fields: name, level (1-4), gender (male/female/mixed)
  - Edit existing group inline or in modal
  - Delete group with confirmation dialog
  - Group name uniqueness validation within league
- State management for:
  - Leagues list
  - Selected league
  - Groups for selected league
  - Form states (create/edit modes)
  - Loading states
  - Error states

### UI Components

**File**: `ui/src/components/ui/table.tsx` (new file)

- Add shadcn table component for displaying leagues and groups
- Include sorting, filtering, and action columns
- Support for inline editing and delete actions

**File**: `ui/src/components/ui/dialog.tsx` (new file)

- Add shadcn dialog component for confirmation dialogs
- Use for delete confirmations and form modals

**File**: `ui/src/components/ui/select.tsx` (new file)

- Add shadcn select component for level and gender dropdowns
- Support for controlled form inputs

**File**: `ui/src/components/ui/date-picker.tsx` (new file)

- Add shadcn date picker component for league date selection
- Integrate with form validation

### Navigation Updates

**File**: `ui/src/components/appSidebar.tsx` (modify existing)

- Add "Admin" section to sidebar (only visible to admins)
- Add "League Management" menu item under Admin section
- Use admin role check to conditionally show admin menu items

### Form Validation

**File**: `ui/src/lib/validation.ts` (new file)

- Create validation schemas for league and group forms
- League validation: name (required, max 255 chars), start_date < end_date
- Group validation: name (required, max 255 chars), level (1-4), gender (enum)
- Client-side validation before API calls
- Error message display for validation failures

### Error Handling

- Global error boundary for admin page
- API error handling with user-friendly messages
- Network error handling with retry options
- Form validation error display
- Loading states for all async operations

### Data Flow Algorithm

1. **Page Load**:

   - Check if user is admin via auth context
   - If not admin, redirect to home with error
   - If admin, fetch leagues list from API
   - Set first league as selected (if any exist)

2. **League Management**:

   - Display leagues in table/card format
   - Create: Show form → validate → API call → refresh list
   - Edit: Show inline form → validate → API call → refresh list
   - Delete: Show confirmation → API call → refresh list

3. **Group Management**:

   - When league selected, fetch groups for that league
   - Display groups in table format
   - Create: Show form → validate → API call → refresh groups list
   - Edit: Show inline form → validate → API call → refresh groups list
   - Delete: Show confirmation → API call → refresh groups list

4. **State Synchronization**:
   - All operations update local state immediately (optimistic updates)
   - On API errors, revert state changes
   - Refresh data from server after successful operations

### Responsive Design

- Mobile-friendly layout with collapsible sections
- Table responsiveness with horizontal scroll on small screens
- Form layouts that work on mobile devices
- Touch-friendly buttons and inputs

### Accessibility

- Proper ARIA labels for all interactive elements
- Keyboard navigation support
- Screen reader compatibility
- Focus management in modals and forms
- Color contrast compliance

## File Structure

```
ui/src/
├── pages/
│   └── AdminLeagues.tsx (new)
├── components/
│   ├── ui/
│   │   ├── table.tsx (new)
│   │   ├── dialog.tsx (new)
│   │   ├── select.tsx (new)
│   │   └── date-picker.tsx (new)
│   └── appSidebar.tsx (modify)
├── lib/
│   ├── auth-context.tsx (modify)
│   ├── serverComm.ts (modify)
│   └── validation.ts (new)
└── App.tsx (modify)
```

## Dependencies

- Existing shadcn components: Button, Card, Input, Label
- New shadcn components: Table, Dialog, Select, DatePicker
- React Router for navigation
- Form validation library (zod or similar)
- Date handling library (date-fns or similar)
